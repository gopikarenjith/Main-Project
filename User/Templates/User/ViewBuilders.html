{% extends 'User/Header.html' %}
{% block content %}
<br><br><br><br><br><br>

<head>
    <title>View Builders</title>
</head>

<style>
    .vb-container * {
        font-family: Arial, sans-serif;
    }

    .vb-container {
        width: 95%;
        margin: auto;
        padding: 20px;
    }

    .vb-title {
        text-align: center;
        font-size: 28px;
        font-weight: bold;
        color: #ff6600;
        margin-bottom: 15px;
    }

    /* üîç SEARCH BAR */
    .vb-search-bar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        justify-content: flex-start;
    }

    .vb-search-bar input,
    .vb-search-bar select {
        padding: 8px 12px;
        border: 2px solid #ff8800;
        border-radius: 6px;
        font-size: 14px;
        min-width: 180px;
    }

    .vb-search-btn {
        background: #ff7700;
        color: white;
        border: none;
        padding: 8px 18px;
        border-radius: 6px;
        cursor: pointer;
    }

    .vb-search-btn:hover {
        background: #ff5500;
    }

    /* TABLE */
    .vb-table {
        width: 100%;
        border-collapse: collapse;
        background: #fffdf8;
        box-shadow: 0 0 12px rgba(255, 102, 0, 0.3);
        border-radius: 10px;
        overflow: hidden;
    }

    .vb-table th {
        background: #ff8800;
        color: white;
        padding: 12px;
        text-align: center;
    }

    .vb-table td {
        padding: 12px;
        border-bottom: 1px solid #ffddbb;
        text-align: center;
    }

    .vb-table tr:hover {
        background: #fff3e6;
    }

    .vb-logo {
        width: 120px;
        border-radius: 8px;
        border: 2px solid #ff8800;
    }

    .vb-action-btn {
        background: #ff7700;
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        text-decoration: none;
        margin: 3px;
        display: inline-block;
    }

    .vb-action-btn:hover {
        background: #ff5500;
    }

    .star-warning {
        color: orange;
    }
</style>

<div class="vb-container">

    <h2 class="vb-title">Registered Builders</h2>

    <!-- üîç SEARCH FORM -->
    <form method="get" class="vb-search-bar">

        <!-- Builder Name -->
        <!-- <input type="text" name="builder"
               placeholder="Search Builder Name"
               value="{{ request.GET.builder }}"> -->

        <!-- District -->
        <select name="district" id="sel_district">
            <option value="">Select District</option>
            {% for d in districtdata %}
                <option value="{{ d.id }}"
                {% if request.GET.district == d.id|stringformat:"s" %}selected{% endif %}>
                    {{ d.district_name }}
                </option>
            {% endfor %}
        </select>

        <!-- Place -->
        <select name="place" id="sel_place">
            <option value="">Select Place</option>
        </select>

        <button type="submit" class="vb-search-btn">Search</button>

    </form>

    <!-- TABLE -->
    <table class="vb-table" id="result">
        <tr>
            <th>SINO</th>
            <th>Name</th>
            <th>Email</th>
            <th>Contact</th>
            <th>Logo</th>
            <th>Address</th>
            <th>District</th>
            <th>Place</th>
            <th>Rating</th>
            <th>Action</th>
        </tr>

        {% for i, j in viewdata %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ i.builders_name }}</td>
            <td>{{ i.builders_email }}</td>
            <td>{{ i.builders_contact }}</td>

            <td>
                <img src="{{ i.builders_logo.url }}" class="vb-logo">
            </td>

            <td>{{ i.builders_address }}</td>
            <td>{{ i.place.district.district_name }}</td>
            <td>{{ i.place.place_name }}</td>

            <td>
                {% for k in ar %}
                    {% if k <= j %}
                        <i class="fa-solid fa-star star-warning"></i>
                    {% else %}
                        <i class="fa-solid fa-star" style="color:#ccc;"></i>
                    {% endif %}
                {% endfor %}
            </td>

            <td>
                <a href="{% url 'User:ViewWork' i.id %}" class="vb-action-btn">View Work</a>
                <a href="{% url 'User:Request' i.id %}" class="vb-action-btn">Request</a>
            </td>
        </tr>

        {% empty %}
        <tr>
            <td colspan="10">No builders found</td>
        </tr>
        {% endfor %}
    </table>

</div>

<!-- JQUERY -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- AJAX PLACE LOAD -->
<script>
    $("#sel_district").change(function () {
        var did = $(this).val();
        $.ajax({
            url: "{% url 'Guest:AjaxPlace' %}",
            data: { did: did },
            success: function (data) {
                $("#sel_place").html(data);
            }
        });
    });

    $("#sel_place").change(function () {
        var pid = $(this).val();
        $.ajax({
            url: "{% url 'User:Ajaxbuilder' %}",
            data: { pid: pid },
            success: function (data) {
                $("#result").html(data);
            }
        });
    });
    
</script>

{% endblock %}
